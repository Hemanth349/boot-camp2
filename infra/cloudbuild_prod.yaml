serviceAccount: projects/project-2-458822/serviceAccounts/hemanth-861@project-2-458822.iam.gserviceaccount.com


options:
  logging: CLOUD_LOGGING_ONLY
  steps:
# 1. Build the Docker image
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'build', '-t', 'gcr.io/$PROJECT_ID/prod-image', '.' ]
   dir: 'infra/my_app

# 2. Push the image to Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'push', 'gcr.io/$PROJECT_ID/prod-image' ]

# 3. Initialize Terraform
- name: 'hashicorp/terraform:light'
  entrypoint: 'sh'
  args:
    - '-c'
    - |
      cd infra/envs/prod
      terraform init

# 4. Apply Terraform (deploy Cloud Run service)
- name: 'hashicorp/terraform:light'
  entrypoint: 'sh'
  args:
    - '-c'
    - |
      cd infra/envs/prod
      terraform apply -auto-approve

images:
- 'gcr.io/$PROJECT_ID/prod-image'
